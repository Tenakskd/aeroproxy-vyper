# Trusted Policy

You must comply, or a violation will occur if your site mandates a Trusted Policy to be used in a certain way, y. Sites can require a trusted policy on a navigation request if they use the `require-trusted-types-for` header and specify where it should be used. Aero automatically blindly wraps a Trusted Policy over everything it clones, just in case the element previously used it because of a mandate. Also, you should intercept `trustedTypes.createPolicy()` and rewrite the HTML if you haven't already done so. What aero is doing can open up another vector of detection, however.

There is a possibility that there is a ReporterObserver staged there to wait for a Trusted Types error to be thrown if your browser has the Trusted Policy APIs. Aero would be detected if this happens. I might be doing more harm than good. But I don't know how to tell if the previous element had a Trusted Policy.

My best solution so far is in my cloning function; I put a decoy "cloned" element that could be sacrificial, send this out to the DOM, and block the main JS thread with a DeferredPromise. At the same time, I waited for a ReporterObserver I created to report that the decoy was "cloned." I only add a Trusted Policy if I get a response back with a message in a message handler also wrapped in a nested DeferredPromise that is resolved to be a value is true; it's the only option because it wouldn't have fired the event if it was false or the timeout as specified by the aero config occurs. I would only do this if the element being cloned is the one that requires a permissions policy. This would only be possible if I forward the `require-trusted-types-for` header to the client-side JS inject script.
